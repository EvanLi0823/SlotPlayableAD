# 多语言本地化模块使用文档

## 概述

本模块提供了完整的多语言文本翻译和货币转换功能，支持以下7个国家/地区：

- **EN** (English) - 英语 / 美元 ($)
- **ID** (Indonesian) - 印尼语 / 印尼盾 (Rp)
- **RU** (Russian) - 俄语 / 俄罗斯卢布 (₽)
- **ES** (Spanish) - 西班牙语 / 欧元 (€)
- **DE** (German) - 德语 / 欧元 (€)
- **FR** (French) - 法语 / 欧元 (€)
- **PT** (Portuguese) - 葡萄牙语 / 巴西雷亚尔 (R$)

## 模块结构

```
assets/Script/
├── LocalizationTypes.ts       # 类型定义
├── LanguageConfigs.ts         # 语言配置和翻译文本
├── LocalizationManager.ts     # 本地化管理器
├── CurrencyConverter.ts       # 货币转换器
└── LocalizationExamples.ts    # 使用示例
```

## 快速开始

### 1. 初始化

在游戏启动时初始化本地化系统：

```typescript
import { LanguageCode } from './LocalizationTypes';
import { i18n } from './LocalizationManager';

// 初始化为英语
i18n.initialize(LanguageCode.EN);

// 或初始化为其他语言
i18n.initialize(LanguageCode.ID); // 印尼语
```

### 2. 获取文本

```typescript
// 获取普通文本
const downloadText = i18n.getText('download');
const tipText = i18n.getText('tipLbl');

// 获取带格式的文本（包含富文本和字体大小）
const guideConfig = i18n.getTextConfig('guide');
console.log(guideConfig.string);    // "<color=#FFFFFF>Tap to Start</color>"
console.log(guideConfig.fontSize);  // 40
```

### 3. 切换语言

```typescript
// 切换到俄语
i18n.setLanguage(LanguageCode.RU);

// 获取当前语言
const currentLang = i18n.getCurrentLanguage(); // 'ru'
```

## 文本内容

所有语言包含以下3个文本字段：

| 键名 | 类型 | 说明 | 英文示例 |
|------|------|------|----------|
| `guide` | ITextConfig | 引导文本（含富文本和字体大小） | `<color=#FFFFFF>Tap to Start</color>` |
| `download` | string | 下载按钮文本 | `Download` |
| `tipLbl` | string | 提示文本 | `The final result is not guaranteed...` |

## 货币转换

### 1. 基础用法

```typescript
import { currency } from './CurrencyConverter';

// 从USD转换为当前语言的货币
i18n.setLanguage(LanguageCode.ID);
const idrAmount = currency.convertFromUSD(100); // 100 USD -> 1570000 IDR
```

### 2. 格式化货币（带货币符号）

```typescript
// 格式化当前语言的货币
i18n.setLanguage(LanguageCode.EN);
console.log(currency.formatCurrent(1234.56)); // "$1,234.56"

i18n.setLanguage(LanguageCode.ID);
console.log(currency.formatCurrent(1570000)); // "Rp1.570.000"

i18n.setLanguage(LanguageCode.RU);
console.log(currency.formatCurrent(9200)); // "9 200,00 ₽"
```

### 3. 转换并格式化（推荐）

```typescript
// 最常用的方法：将USD金额转换为当前货币并格式化显示
const gameAmount = 50; // 游戏内金额（USD）

i18n.setLanguage(LanguageCode.EN);
console.log(currency.convertAndFormat(gameAmount)); // "$50.00"

i18n.setLanguage(LanguageCode.PT);
console.log(currency.convertAndFormat(gameAmount)); // "R$248,50"
```

### 4. 货币格式配置

每种货币都有默认的格式化配置：

| 货币 | 小数位 | 符号位置 | 千位分隔符 | 小数分隔符 | 示例 |
|------|--------|----------|------------|------------|------|
| USD | 2 | 前缀 | , | . | $1,234.56 |
| IDR | 0 | 前缀 | . | , | Rp1.570.000 |
| RUB | 2 | 后缀 | 空格 | , | 9 200,00 ₽ |
| EUR | 2 | 后缀 | . | , | 92,50 € |
| BRL | 2 | 前缀 | . | , | R$248,50 |

### 5. 自定义格式

```typescript
// 自定义小数位数
currency.formatCurrent(1234.56, { decimals: 0 }); // "$1,235"

// 自定义分隔符
currency.formatCurrent(1234.56, {
    thousandsSeparator: ' ',
    decimalSeparator: '.'
}); // "$1 234.56"
```

## 汇率配置

默认汇率（相对于USD）：

```typescript
USD: 1
IDR: 15700  // 印尼盾
RUB: 92     // 俄罗斯卢布
EUR: 0.92   // 欧元
BRL: 4.97   // 巴西雷亚尔
```

可以动态更新汇率：

```typescript
currency.updateExchangeRates({
    IDR: 15800,
    RUB: 95,
    EUR: 0.93,
    BRL: 5.0
});
```

## 在Cocos Creator中集成

### 示例：更新UI文本

```typescript
import { cc, Component } from 'cc';
import { LanguageCode } from './LocalizationTypes';
import { i18n } from './LocalizationManager';
import { currency } from './CurrencyConverter';

export class GameController extends Component {

    onLoad() {
        // 1. 初始化语言（从配置获取）
        const userLanguage = this.getUserLanguage();
        i18n.initialize(userLanguage);

        // 2. 更新所有UI文本
        this.updateUI();
    }

    getUserLanguage(): LanguageCode {
        // 从配置或用户设置获取语言
        return LanguageCode.EN;
    }

    updateUI() {
        // 更新引导文本
        const guideConfig = i18n.getTextConfig('guide');
        const guideLabel = this.node.getChildByName('GuideLabel').getComponent(cc.Label);
        guideLabel.string = guideConfig.string;
        guideLabel.fontSize = guideConfig.fontSize;

        // 更新下载按钮
        const downloadBtn = this.node.getChildByName('DownloadBtn');
        const btnLabel = downloadBtn.getComponentInChildren(cc.Label);
        btnLabel.string = i18n.getText('download');

        // 更新提示文本
        const tipLabel = this.node.getChildByName('TipLabel').getComponent(cc.Label);
        tipLabel.string = i18n.getText('tipLbl');
    }

    // 显示中奖金额
    showWinAmount(usdAmount: number) {
        const formattedAmount = currency.convertAndFormat(usdAmount);
        const winLabel = this.node.getChildByName('WinLabel').getComponent(cc.Label);
        winLabel.string = formattedAmount;
    }

    // 切换语言
    switchLanguage(langCode: LanguageCode) {
        i18n.setLanguage(langCode);
        this.updateUI();
    }
}
```

## API 参考

### LocalizationManager (i18n)

| 方法 | 参数 | 返回值 | 说明 |
|------|------|--------|------|
| `initialize()` | language: LanguageCode | void | 初始化并设置语言 |
| `setLanguage()` | langCode: LanguageCode | void | 切换语言 |
| `getCurrentLanguage()` | - | LanguageCode | 获取当前语言代码 |
| `getTextConfig()` | key: 'guide' | ITextConfig | 获取带格式的文本配置 |
| `getText()` | key: 'download' \| 'tipLbl' | string | 获取文本 |
| `getCurrentCurrency()` | - | string | 获取当前货币代码 |
| `getCurrentCurrencySymbol()` | - | string | 获取当前货币符号 |
| `getSupportedLanguages()` | - | ILanguageData[] | 获取所有支持的语言 |

### CurrencyConverter (currency)

| 方法 | 参数 | 返回值 | 说明 |
|------|------|--------|------|
| `convertFromUSD()` | usdAmount: number | number | USD转换为当前货币 |
| `formatCurrent()` | amount: number, options? | string | 格式化当前货币 |
| `convertAndFormat()` | usdAmount: number, options? | string | 转换并格式化（推荐） |
| `updateExchangeRates()` | rates: ICurrencyRate | void | 更新汇率 |
| `convert()` | amount, from, to | number | 任意货币间转换 |
| `format()` | amount, currency, options? | string | 格式化指定货币 |

## 注意事项

1. **语言由代码指定**：本模块不会自动检测浏览器语言，需要在代码中明确指定
2. **汇率更新**：默认汇率是固定的，如需动态汇率请调用 `updateExchangeRates()`
3. **货币符号**：每个语言都配置了对应的货币符号，会自动在格式化时添加
4. **单例模式**：LocalizationManager 和 CurrencyConverter 都是单例，使用 `i18n` 和 `currency` 导出的实例即可

## 常见问题

### Q: 如何添加新的文本字段？

1. 在 `LocalizationTypes.ts` 的 `ILanguageTexts` 接口中添加字段
2. 在 `LanguageConfigs.ts` 中为所有语言添加对应的翻译
3. 在 `LocalizationManager.ts` 中添加对应的 getter 方法

### Q: 如何添加新语言？

1. 在 `LocalizationTypes.ts` 中添加语言代码和货币代码枚举
2. 在 `LanguageConfigs.ts` 中添加新语言的配置
3. 在 `CurrencyConverter.ts` 中添加汇率和格式化配置

### Q: 货币转换精度问题？

所有货币转换都会根据配置的小数位数进行四舍五入，可以通过 `decimals` 选项自定义。

## 完整示例

查看 `LocalizationExamples.ts` 文件获取更多详细示例。
