<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥å¿—ä¸‹è½½åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .test-section h2 {
            color: #333;
            margin-top: 0;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
        }

        #log-stats {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        #log-stats h3 {
            margin-top: 0;
            color: #667eea;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-weight: bold;
            color: #555;
        }

        .stat-value {
            color: #667eea;
            font-weight: bold;
        }

        /* æ—¥å¿—ä¸‹è½½é¢æ¿æ ·å¼ */
        #log-download-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            background: rgba(0, 0, 0, 0.85);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .log-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        #download-txt-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        #download-json-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        #clear-logs-btn {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        #log-stats-btn {
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
        }

        .log-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .log-btn:active {
            transform: translateY(0);
        }

        #log-count {
            color: white;
            font-size: 12px;
            text-align: center;
            margin-top: 8px;
            font-family: monospace;
            padding: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #2196f3;
        }

        .info-box h3 {
            margin-top: 0;
            color: #1976d2;
        }

        .info-box ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .info-box li {
            margin: 5px 0;
            color: #555;
        }
    </style>
</head>
<body>
    <!-- æ—¥å¿—ä¸‹è½½é¢æ¿ -->
    <div id="log-download-panel">
        <button id="download-txt-btn" class="log-btn">ğŸ“„ Download TXT</button>
        <button id="download-json-btn" class="log-btn">ğŸ“‹ Download JSON</button>
        <button id="clear-logs-btn" class="log-btn">ğŸ—‘ï¸ Clear Logs</button>
        <button id="log-stats-btn" class="log-btn">ğŸ“Š Show Stats</button>
        <div id="log-count">Logs: 0</div>
    </div>

    <div class="container">
        <h1>ğŸ® æµè§ˆå™¨æ—¥å¿—ä¸‹è½½åŠŸèƒ½æµ‹è¯•</h1>

        <div class="test-section">
            <h2>ğŸ“ 1. ç”Ÿæˆæµ‹è¯•æ—¥å¿—</h2>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®ç”Ÿæˆä¸åŒç±»å‹çš„æ—¥å¿—ï¼š</p>
            <div class="button-group">
                <button class="btn-primary" onclick="generateNormalLogs()">ç”Ÿæˆæ™®é€šæ—¥å¿—</button>
                <button class="btn-success" onclick="generateInfoLogs()">ç”Ÿæˆä¿¡æ¯æ—¥å¿—</button>
                <button class="btn-warning" onclick="generateWarningLogs()">ç”Ÿæˆè­¦å‘Šæ—¥å¿—</button>
                <button class="btn-danger" onclick="generateErrorLogs()">ç”Ÿæˆé”™è¯¯æ—¥å¿—</button>
                <button class="btn-info" onclick="generateMixedLogs()">ç”Ÿæˆæ··åˆæ—¥å¿—</button>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š 2. æŸ¥çœ‹æ—¥å¿—ç»Ÿè®¡</h2>
            <p>ç‚¹å‡»å³ä¸Šè§’çš„"ğŸ“Š Show Stats"æŒ‰é’®ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹æ—¥å¿—ç»Ÿè®¡ä¿¡æ¯ã€‚</p>
            <button class="btn-info" onclick="showStats()">æ˜¾ç¤ºç»Ÿè®¡ï¼ˆæ§åˆ¶å°ï¼‰</button>
            <button class="btn-primary" onclick="showStatsInPage()">æ˜¾ç¤ºç»Ÿè®¡ï¼ˆé¡µé¢ï¼‰</button>
            <div id="log-stats"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ’¾ 3. ä¸‹è½½æ—¥å¿—</h2>
            <p>ä½¿ç”¨å³ä¸Šè§’çš„ä¸‹è½½æŒ‰é’®å¯ä»¥å°†æ—¥å¿—ä¿å­˜åˆ°æœ¬åœ°ï¼š</p>
            <div class="button-group">
                <button class="btn-primary" onclick="downloadTxt()">ä¸‹è½½ä¸ºTXT</button>
                <button class="btn-warning" onclick="downloadJson()">ä¸‹è½½ä¸ºJSON</button>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ” 4. é«˜çº§åŠŸèƒ½æµ‹è¯•</h2>
            <div class="button-group">
                <button class="btn-info" onclick="searchLogs()">æœç´¢æ—¥å¿—ï¼ˆ"test"ï¼‰</button>
                <button class="btn-success" onclick="filterErrorLogs()">è¿‡æ»¤é”™è¯¯æ—¥å¿—</button>
                <button class="btn-primary" onclick="getRecentLogs()">è·å–æœ€è¿‘10æ¡</button>
            </div>
        </div>

        <div class="info-box">
            <h3>ğŸ“š ä½¿ç”¨è¯´æ˜</h3>
            <ul>
                <li><strong>è‡ªåŠ¨æ”¶é›†ï¼š</strong>æ‰€æœ‰consoleæ—¥å¿—ï¼ˆlog, warn, error, infoï¼‰éƒ½ä¼šè¢«è‡ªåŠ¨æ”¶é›†</li>
                <li><strong>å®æ—¶æ˜¾ç¤ºï¼š</strong>å³ä¸Šè§’æ˜¾ç¤ºå½“å‰æ”¶é›†çš„æ—¥å¿—æ•°é‡ï¼Œæ¯ç§’è‡ªåŠ¨æ›´æ–°</li>
                <li><strong>ä¸‹è½½æ ¼å¼ï¼š</strong>æ”¯æŒTXTå’ŒJSONä¸¤ç§æ ¼å¼</li>
                <li><strong>å®¹é‡é™åˆ¶ï¼š</strong>æœ€å¤šä¿å­˜5000æ¡æ—¥å¿—ï¼Œè¶…å‡ºåè‡ªåŠ¨åˆ é™¤æœ€æ—©çš„æ—¥å¿—</li>
                <li><strong>è°ƒè¯•è®¿é—®ï¼š</strong>å¯ä»¥åœ¨æ§åˆ¶å°é€šè¿‡<code>window.logManager</code>è®¿é—®æ—¥å¿—ç®¡ç†å™¨</li>
            </ul>
        </div>

        <div class="info-box">
            <h3>ğŸ”§ æ§åˆ¶å°å‘½ä»¤</h3>
            <p>æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
            <ul>
                <li><code>logManager.getAllLogs()</code> - è·å–æ‰€æœ‰æ—¥å¿—</li>
                <li><code>logManager.getLogStats()</code> - è·å–æ—¥å¿—ç»Ÿè®¡</li>
                <li><code>logManager.searchLogs("keyword")</code> - æœç´¢æ—¥å¿—</li>
                <li><code>logManager.getLogsByLevel(LogLevel.ERROR)</code> - æŒ‰çº§åˆ«è¿‡æ»¤</li>
                <li><code>logManager.clearLogs()</code> - æ¸…ç©ºæ—¥å¿—</li>
            </ul>
        </div>
    </div>

    <script>
        // LogManagerä»£ç ï¼ˆç®€åŒ–ç‰ˆï¼Œç›´æ¥åµŒå…¥ï¼‰
        var LogLevel = {
            LOG: "LOG",
            WARN: "WARN",
            ERROR: "ERROR",
            INFO: "INFO"
        };

        class LogManager {
            constructor() {
                this.logs = [];
                this.maxLogs = 5000;
                this.originalConsole = {
                    log: console.log,
                    warn: console.warn,
                    error: console.error,
                    info: console.info
                };
                this.interceptConsoleLogs();
            }

            static getInstance() {
                if (!LogManager.instance) {
                    LogManager.instance = new LogManager();
                }
                return LogManager.instance;
            }

            interceptConsoleLogs() {
                const self = this;

                console.log = function(...args) {
                    self.addLog(LogLevel.LOG, args);
                    self.originalConsole.log.apply(console, args);
                };

                console.warn = function(...args) {
                    self.addLog(LogLevel.WARN, args);
                    self.originalConsole.warn.apply(console, args);
                };

                console.error = function(...args) {
                    self.addLog(LogLevel.ERROR, args);
                    self.originalConsole.error.apply(console, args);
                };

                console.info = function(...args) {
                    self.addLog(LogLevel.INFO, args);
                    self.originalConsole.info.apply(console, args);
                };

                this.originalConsole.log.call(console, "[LogManager] Console log interception initialized");
            }

            addLog(level, args) {
                const timestamp = this.getTimestamp();
                const message = this.formatMessage(args);

                const logEntry = {
                    timestamp,
                    level,
                    message
                };

                this.logs.push(logEntry);

                if (this.logs.length > this.maxLogs) {
                    this.logs.shift();
                }
            }

            formatMessage(args) {
                return args.map(arg => {
                    if (typeof arg === 'object') {
                        try {
                            return JSON.stringify(arg, null, 2);
                        } catch (e) {
                            return String(arg);
                        }
                    }
                    return String(arg);
                }).join(' ');
            }

            getTimestamp() {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                const milliseconds = String(now.getMilliseconds()).padStart(3, '0');

                return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`;
            }

            getAllLogs() {
                return [...this.logs];
            }

            clearLogs() {
                this.logs = [];
                console.log("[LogManager] All logs cleared");
            }

            getLogCount() {
                return this.logs.length;
            }

            exportLogsAsText() {
                let text = `=== Game Logs Export ===\n`;
                text += `Export Time: ${this.getTimestamp()}\n`;
                text += `Total Logs: ${this.logs.length}\n`;
                text += `${"=".repeat(80)}\n\n`;

                this.logs.forEach((log, index) => {
                    text += `[${index + 1}] [${log.timestamp}] [${log.level}]\n`;
                    text += `${log.message}\n`;
                    text += `${"-".repeat(80)}\n`;
                });

                return text;
            }

            exportLogsAsJSON() {
                const exportData = {
                    exportTime: this.getTimestamp(),
                    totalLogs: this.logs.length,
                    logs: this.logs
                };

                return JSON.stringify(exportData, null, 2);
            }

            downloadLogsAsText() {
                const content = this.exportLogsAsText();
                const filename = `game-logs-${this.getFilenameTimestamp()}.txt`;
                this.downloadFile(content, filename, 'text/plain');
                console.log(`[LogManager] Logs downloaded as text: ${filename}`);
            }

            downloadLogsAsJSON() {
                const content = this.exportLogsAsJSON();
                const filename = `game-logs-${this.getFilenameTimestamp()}.json`;
                this.downloadFile(content, filename, 'application/json');
                console.log(`[LogManager] Logs downloaded as JSON: ${filename}`);
            }

            getFilenameTimestamp() {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');

                return `${year}${month}${day}-${hours}${minutes}${seconds}`;
            }

            downloadFile(content, filename, mimeType) {
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;

                document.body.appendChild(link);
                link.click();

                setTimeout(() => {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 100);
            }

            getLogsByLevel(level) {
                return this.logs.filter(log => log.level === level);
            }

            searchLogs(keyword) {
                const lowerKeyword = keyword.toLowerCase();
                return this.logs.filter(log =>
                    log.message.toLowerCase().includes(lowerKeyword)
                );
            }

            getRecentLogs(count) {
                return this.logs.slice(-count);
            }

            getLogStats() {
                return {
                    total: this.logs.length,
                    logCount: this.getLogsByLevel(LogLevel.LOG).length,
                    warnCount: this.getLogsByLevel(LogLevel.WARN).length,
                    errorCount: this.getLogsByLevel(LogLevel.ERROR).length,
                    infoCount: this.getLogsByLevel(LogLevel.INFO).length
                };
            }

            printLogStats() {
                const stats = this.getLogStats();
                console.log("=== Log Statistics ===");
                console.log(`Total: ${stats.total}`);
                console.log(`LOG: ${stats.logCount}`);
                console.log(`WARN: ${stats.warnCount}`);
                console.log(`ERROR: ${stats.errorCount}`);
                console.log(`INFO: ${stats.infoCount}`);
                console.log("=====================");
            }
        }

        // åˆå§‹åŒ–æ—¥å¿—ç®¡ç†å™¨
        const logManager = LogManager.getInstance();
        window.logManager = logManager;

        // è®¾ç½®æŒ‰é’®äº‹ä»¶
        document.getElementById('download-txt-btn').addEventListener('click', () => {
            logManager.downloadLogsAsText();
        });

        document.getElementById('download-json-btn').addEventListener('click', () => {
            logManager.downloadLogsAsJSON();
        });

        document.getElementById('clear-logs-btn').addEventListener('click', () => {
            logManager.clearLogs();
            updateLogCount();
        });

        document.getElementById('log-stats-btn').addEventListener('click', () => {
            logManager.printLogStats();
        });

        // æ›´æ–°æ—¥å¿—è®¡æ•°
        function updateLogCount() {
            const count = logManager.getLogCount();
            document.getElementById('log-count').textContent = `Logs: ${count}`;
        }

        // å®šæœŸæ›´æ–°æ—¥å¿—è®¡æ•°
        setInterval(updateLogCount, 1000);

        // æµ‹è¯•å‡½æ•°
        function generateNormalLogs() {
            for (let i = 0; i < 10; i++) {
                console.log(`[Test] Normal log message ${i + 1}`);
            }
            console.log("âœ“ å·²ç”Ÿæˆ10æ¡æ™®é€šæ—¥å¿—");
        }

        function generateInfoLogs() {
            for (let i = 0; i < 10; i++) {
                console.info(`[Test] Info message ${i + 1}: System is running normally`);
            }
            console.log("âœ“ å·²ç”Ÿæˆ10æ¡ä¿¡æ¯æ—¥å¿—");
        }

        function generateWarningLogs() {
            for (let i = 0; i < 10; i++) {
                console.warn(`[Test] Warning ${i + 1}: Resource usage is high`);
            }
            console.log("âœ“ å·²ç”Ÿæˆ10æ¡è­¦å‘Šæ—¥å¿—");
        }

        function generateErrorLogs() {
            for (let i = 0; i < 10; i++) {
                console.error(`[Test] Error ${i + 1}: Something went wrong`);
            }
            console.log("âœ“ å·²ç”Ÿæˆ10æ¡é”™è¯¯æ—¥å¿—");
        }

        function generateMixedLogs() {
            console.log("[Test] Starting mixed log generation...");
            console.info("[Test] System initialized");
            console.warn("[Test] Memory usage: 75%");
            console.error("[Test] Failed to load resource");
            console.log("[Test] Processing item 1");
            console.log("[Test] Processing item 2");
            console.warn("[Test] Connection unstable");
            console.error("[Test] Network timeout");
            console.info("[Test] Attempting reconnection");
            console.log("[Test] Reconnection successful");
            console.log("âœ“ å·²ç”Ÿæˆ10æ¡æ··åˆæ—¥å¿—");
        }

        function showStats() {
            logManager.printLogStats();
        }

        function showStatsInPage() {
            const stats = logManager.getLogStats();
            const statsDiv = document.getElementById('log-stats');
            statsDiv.innerHTML = `
                <h3>ğŸ“Š æ—¥å¿—ç»Ÿè®¡</h3>
                <div class="stat-item">
                    <span class="stat-label">æ€»è®¡:</span>
                    <span class="stat-value">${stats.total}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">LOG:</span>
                    <span class="stat-value">${stats.logCount}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">INFO:</span>
                    <span class="stat-value">${stats.infoCount}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">WARN:</span>
                    <span class="stat-value">${stats.warnCount}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ERROR:</span>
                    <span class="stat-value">${stats.errorCount}</span>
                </div>
            `;
        }

        function downloadTxt() {
            logManager.downloadLogsAsText();
        }

        function downloadJson() {
            logManager.downloadLogsAsJSON();
        }

        function searchLogs() {
            const results = logManager.searchLogs("test");
            console.log(`æœç´¢ç»“æœ: æ‰¾åˆ° ${results.length} æ¡åŒ…å« "test" çš„æ—¥å¿—`);
            console.table(results);
        }

        function filterErrorLogs() {
            const errors = logManager.getLogsByLevel(LogLevel.ERROR);
            console.log(`é”™è¯¯æ—¥å¿—: å…± ${errors.length} æ¡`);
            console.table(errors);
        }

        function getRecentLogs() {
            const recent = logManager.getRecentLogs(10);
            console.log("æœ€è¿‘10æ¡æ—¥å¿—:");
            console.table(recent);
        }

        // åˆå§‹æ—¥å¿—
        console.log("=== æ—¥å¿—ç³»ç»Ÿå·²åˆå§‹åŒ– ===");
        console.log("æ¬¢è¿ä½¿ç”¨æµè§ˆå™¨æ—¥å¿—ä¸‹è½½åŠŸèƒ½æµ‹è¯•é¡µé¢");
        console.log("è¯·ç‚¹å‡»é¡µé¢ä¸Šçš„æŒ‰é’®ç”Ÿæˆæµ‹è¯•æ—¥å¿—");
        console.log("========================");
    </script>
</body>
</html>
