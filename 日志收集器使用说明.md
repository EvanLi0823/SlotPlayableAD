# 日志收集器使用说明

## 功能说明
这是一个简单的浏览器日志收集工具，可以：
1. **自动拦截**所有 `console.log/warn/error/info` 输出
2. **内存存储**所有日志内容到一个列表中
3. **一键下载**点击按钮生成文件并下载

## 使用方法

### 方法1：控制台运行（推荐）

1. 打开你的游戏页面（例如：`build/web-mobile/index.html`）
2. 按 `F12` 打开浏览器开发者工具
3. 切换到 **Console（控制台）** 标签
4. 打开 `日志收集器.js` 文件
5. 复制整个文件内容
6. 粘贴到控制台并按回车运行
7. 右上角会出现日志收集面板

### 方法2：在HTML中引入

在 `build/web-mobile/index.html` 的 `</body>` 标签前添加：

```html
<script src="../../日志收集器.js"></script>
```

**注意**：每次重新构建项目后，需要重新添加这行代码。

## 界面说明

运行后，页面右上角会出现一个悬浮面板：

```
┌─────────────────┐
│ 🎮 日志收集  − × │
├─────────────────┤
│  📄 下载TXT      │
│  📋 下载JSON     │
│  🗑️ 清空日志     │
│  📊 查看统计     │
│  日志: 123       │
└─────────────────┘
```

### 按钮功能

- **📄 下载TXT** - 将所有日志下载为文本文件（易读格式）
- **📋 下载JSON** - 将所有日志下载为JSON文件（便于程序分析）
- **🗑️ 清空日志** - 清空内存中的所有日志
- **📊 查看统计** - 在控制台显示日志统计信息
- **−** 按钮 - 最小化/展开面板
- **×** 按钮 - 关闭面板

### 其他功能

- **可拖拽**：点击标题栏可以拖拽移动面板位置
- **实时计数**：显示当前已收集的日志数量，每秒更新

## 下载的文件格式

### TXT格式示例

```
=== 日志导出 ===
导出时间: 2026-01-10 14:30:45.123
页面地址: http://localhost:8080/build/web-mobile/index.html
日志总数: 150
================================================================================

[1] [2026-01-10 14:30:01.234] [LOG]
[GameScene] Initializing game scene...
--------------------------------------------------------------------------------
[2] [2026-01-10 14:30:01.456] [WARN]
Memory usage high: 85%
--------------------------------------------------------------------------------
[3] [2026-01-10 14:30:01.678] [ERROR]
Failed to load resource: texture.png
--------------------------------------------------------------------------------
```

### JSON格式示例

```json
{
  "exportTime": "2026-01-10 14:30:45.123",
  "pageUrl": "http://localhost:8080/build/web-mobile/index.html",
  "totalLogs": 150,
  "logs": [
    {
      "timestamp": "2026-01-10 14:30:01.234",
      "level": "LOG",
      "message": "[GameScene] Initializing game scene..."
    },
    {
      "timestamp": "2026-01-10 14:30:01.456",
      "level": "WARN",
      "message": "Memory usage high: 85%"
    }
  ]
}
```

## 控制台命令

在浏览器控制台中可以使用以下命令：

```javascript
// 下载TXT格式日志
window.logCollector.downloadTxt()

// 下载JSON格式日志
window.logCollector.downloadJson()

// 清空所有日志
window.logCollector.clearLogs()

// 查看统计信息
window.logCollector.getStats()

// 直接访问日志列表
window.logCollector.logs
```

## 统计信息示例

点击"📊 查看统计"按钮后，控制台会显示：

```
=== 日志统计 ===
总计: 150
LOG: 120
INFO: 10
WARN: 15
ERROR: 5
```

## 工作原理

1. **拦截日志**：替换 `console.log/warn/error/info` 函数
2. **存储到列表**：每次调用时，将日志内容添加到数组
3. **保留原功能**：调用原始函数，不影响控制台正常显示
4. **生成文件**：点击下载时，遍历列表生成文件内容
5. **触发下载**：使用 Blob 和 URL.createObjectURL 触发浏览器下载

## 注意事项

1. **内存限制**：最多保存 5000 条日志，超出后自动删除最早的日志
2. **刷新后失效**：刷新页面后需要重新运行代码
3. **兼容性**：支持现代浏览器（Chrome、Firefox、Edge、Safari）
4. **Cocos Creator**：自动拦截 `cc.log/warn/error`

## 常见问题

### Q: 面板没有出现？
A: 检查是否有错误提示，确保代码完整复制并运行

### Q: 下载的文件是空的？
A: 可能还没有收集到日志，先运行游戏产生一些日志输出

### Q: 如何在移动设备上使用？
A: 可以使用 [Eruda](https://github.com/liriliri/eruda) 等移动端调试工具打开控制台

### Q: 可以过滤特定日志吗？
A: 可以在控制台使用：
```javascript
// 只查看ERROR级别的日志
window.logCollector.logs.filter(log => log.level === 'ERROR')

// 搜索包含关键字的日志
window.logCollector.logs.filter(log => log.message.includes('GameScene'))
```

## 示例：分析下载的日志

下载JSON格式后，可以用Python分析：

```python
import json

# 读取日志文件
with open('logs-20260110-143045.json', 'r', encoding='utf-8') as f:
    data = json.load(f)

# 统计各类型日志
for log in data['logs']:
    print(f"[{log['level']}] {log['message']}")

# 只看错误日志
errors = [log for log in data['logs'] if log['level'] == 'ERROR']
print(f"共有 {len(errors)} 条错误")
```

## 技术支持

如有问题，可以：
1. 查看浏览器控制台的错误信息
2. 检查 `window.logCollector` 对象是否存在
3. 使用 `window.logCollector.logs` 查看已收集的日志
